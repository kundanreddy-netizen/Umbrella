<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Umbrella">
    <title>Umbrella</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            background: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            position: relative;
        }

        .sync-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .sync-indicator.syncing {
            background: #FFC107;
            animation: spin 1s linear infinite;
        }

        .sync-indicator.error {
            background: #F44336;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .sync-status {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .content-container {
            max-width: 500px;
            margin: 20px auto;
        }

        .tab-nav {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .card:active {
            transform: scale(0.98);
        }

        .announcement-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .announcement-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
        }

        .announcement-content {
            font-size: 15px;
            color: #555;
            line-height: 1.6;
        }

        .announcement-category {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 10px;
        }

        .owner-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .owner-details {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .owner-details div {
            margin-bottom: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 16px;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
            line-height: 1.6;
        }

        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            transition: transform 0.2s;
        }

        .refresh-btn:active {
            transform: scale(0.9);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: white;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .welcome-screen {
            max-width: 500px;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .welcome-screen h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .welcome-screen p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="sync-indicator" id="syncIndicator" title="Sync status"></div>
        <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 20 C30 20, 15 30, 15 45 L15 50 C15 50, 20 60, 50 60 C80 60, 85 50, 85 50 L85 45 C85 30, 70 20, 50 20 Z" fill="#667eea"/>
            <rect x="48" y="55" width="4" height="35" fill="#764ba2" rx="2"/>
            <path d="M48 85 C48 85, 42 95, 35 95" stroke="#764ba2" stroke-width="3" fill="none" stroke-linecap="round"/>
        </svg>
        <div class="app-title">Umbrella</div>
        <div class="sync-status" id="syncStatus">Checking for updates...</div>
    </div>

    <div id="welcomeScreen" class="welcome-screen" style="display: none;">
        <h2>ðŸ‘‹ Welcome to Umbrella!</h2>
        <p>The admin hasn't published any data yet. Please ask your administrator to upload the resident directory and announcements.</p>
        <button class="refresh-btn" onclick="syncData()" style="position: static; margin-top: 20px;">
            ðŸ”„ Check Again
        </button>
    </div>

    <div class="content-container" id="contentContainer" style="display: none;">
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('announcements')">ðŸ“¢ Community</button>
            <button class="tab-btn" onclick="switchTab('owners')">ðŸ‘¥ Residents</button>
        </div>

        <div id="announcementsContent" class="tab-content active">
            <div class="loading">
                <div class="spinner"></div>
                Loading announcements...
            </div>
        </div>

        <div id="ownersContent" class="tab-content">
            <div class="loading">
                <div class="spinner"></div>
                Loading residents...
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="syncData()" id="refreshBtn" style="display: none;">â†»</button>

    <script>
        let appData = {
            owners: [],
            announcements: []
        };

        let syncInterval;

        // Initialize app
        window.addEventListener('DOMContentLoaded', async () => {
            await syncData();
            
            // Auto-sync every 30 seconds
            syncInterval = setInterval(syncData, 30000);
        });

        async function syncData() {
            const syncIndicator = document.getElementById('syncIndicator');
            const syncStatus = document.getElementById('syncStatus');
            
            syncIndicator.className = 'sync-indicator syncing';
            syncStatus.textContent = 'Syncing...';

            try {
                // Fetch data from GitHub
                const response = await fetch(
                    'https://raw.githubusercontent.com/kundanreddy-netizen/Umbrella/main/umbrella-data.json',
                    {
                        cache: 'no-cache'
                    }
                );
                
                if (response.ok) {
                    const data = await response.json();
                    appData.owners = data.owners || [];
                    appData.announcements = data.announcements || [];
                    
                    // Update UI
                    displayData();
                    
                    // Show content
                    document.getElementById('welcomeScreen').style.display = 'none';
                    document.getElementById('contentContainer').style.display = 'block';
                    document.getElementById('refreshBtn').style.display = 'flex';
                    
                    // Update sync status
                    syncIndicator.className = 'sync-indicator';
                    const lastUpdated = new Date(data.lastUpdated);
                    syncStatus.textContent = `Last updated: ${lastUpdated.toLocaleTimeString()}`;
                    
                } else {
                    // No data available yet
                    document.getElementById('welcomeScreen').style.display = 'block';
                    document.getElementById('contentContainer').style.display = 'none';
                    document.getElementById('refreshBtn').style.display = 'none';
                    
                    syncIndicator.className = 'sync-indicator';
                    syncStatus.textContent = 'Waiting for data...';
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                syncIndicator.className = 'sync-indicator error';
                syncStatus.textContent = 'Sync failed - will retry';
                
                // Show welcome screen if no data
                if (appData.owners.length === 0 && appData.announcements.length === 0) {
                    document.getElementById('welcomeScreen').style.display = 'block';
                    document.getElementById('contentContainer').style.display = 'none';
                }
            }
        }

        function displayData() {
            displayAnnouncements();
            displayOwners();
        }

        function displayAnnouncements() {
            const container = document.getElementById('announcementsContent');

            if (appData.announcements.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸ“¢</div><div>No announcements yet</div></div>';
                return;
            }

            let html = '';
            appData.announcements.forEach(announcement => {
                const title = announcement.Subject || announcement.subject || announcement.Title || announcement.title || 'Announcement';
                const date = announcement.Date || announcement.date || '';
                const message = announcement.Message || announcement.message || announcement.Content || announcement.content || '';
                const author = announcement.Author || announcement.author || '';
                const category = announcement.Category || announcement.category || '';

                html += `
                    <div class="card">
                        <div class="announcement-title">${title}</div>
                        ${date ? `<div class="announcement-date">${date}${author ? ' â€¢ ' + author : ''}</div>` : ''}
                        <div class="announcement-content">${message}</div>
                        ${category ? `<div class="announcement-category">${category}</div>` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function displayOwners() {
            const container = document.getElementById('ownersContent');

            if (appData.owners.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸ‘¥</div><div>No residents listed</div></div>';
                return;
            }

            let html = '';
            appData.owners.forEach(owner => {
                const name = owner.Name || owner.name || 'Resident';
                
                let details = '';
                Object.keys(owner).forEach(key => {
                    if (key.toLowerCase() !== 'name' && owner[key]) {
                        details += `<div><strong>${key}:</strong> ${owner[key]}</div>`;
                    }
                });

                html += `
                    <div class="card">
                        <div class="owner-name">${name}</div>
                        <div class="owner-details">${details}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            if (tab === 'announcements') {
                document.getElementById('announcementsContent').classList.add('active');
            } else {
                document.getElementById('ownersContent').classList.add('active');
            }
        }

        // Clean up interval when page unloads
        window.addEventListener('beforeunload', () => {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
        });
    </script>
</body>
</html>
